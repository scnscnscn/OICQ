# SimpleQQ 非功能需求与错误处理设计文档

## 4. 非功能需求描述

### 4.1 性能需求

#### 4.1.1 并发性能要求
- **最大并发用户数**：系统应支持至少200个用户同时在线
- **最大并发操作数**：系统应能同时处理至少500个并发操作（包括消息发送、好友请求、群组操作等）
- **峰值负载处理**：在用户数达到150个时，系统仍能保持稳定运行，不出现明显性能下降

#### 4.1.2 响应时间要求
- **用户登录响应时间**：用户登录验证的响应时间应不超过3秒
- **消息传输延迟**：私聊消息从发送到接收的延迟应不超过1秒
- **群聊消息广播时间**：群组消息向所有在线成员广播的时间应不超过2秒
- **好友请求处理时间**：好友请求的发送和处理响应时间应不超过2秒
- **文件传输启动时间**：图片文件传输的启动响应时间应不超过3秒

#### 4.1.3 数据处理性能
- **数据更新处理时间**：用户状态更新（上线/离线）的同步时间应不超过5秒
- **数据转换时间**：图片文件的Base64编码/解码处理时间应不超过文件大小（MB）×2秒
- **界面刷新处理时间**：好友列表、群组列表的界面刷新时间应不超过1秒
- **聊天记录加载时间**：聊天历史记录的加载时间应不超过3秒

#### 4.1.4 数据容量要求
- **单次消息最大长度**：文本消息最大支持2048个字符
- **图片文件大小限制**：单个图片文件大小不超过10MB
- **聊天记录存储容量**：每个用户的聊天记录总容量限制为100MB
- **系统数据存储上限**：整个系统的数据文件总大小限制为1GB

#### 4.1.5 系统资源占用要求
- **服务器内存占用**：服务器程序的内存占用应不超过512MB
- **客户端内存占用**：单个客户端程序的内存占用应不超过256MB
- **CPU使用率**：正常运行时服务器CPU使用率应不超过70%
- **网络带宽**：系统整体网络带宽占用应不超过10Mbps

#### 4.1.6 持续运行能力
- **系统持续运行时间**：服务器应能连续稳定运行72小时以上
- **客户端稳定性**：客户端程序应能连续运行8小时以上不出现内存泄漏
- **连接保持时间**：客户端与服务器的连接应能保持稳定，支持长时间在线

#### 4.1.7 环境适应性要求
在不同的运行环境下，系统性能的可接受变化范围：
- **不同操作系统**：Windows、macOS、Linux环境下的性能差异应不超过20%
- **不同Java版本**：JDK 17-21版本下的性能表现应保持一致
- **不同硬件配置**：在最低配置要求（2GB内存，双核CPU）下仍能正常运行
- **网络环境变化**：在网络延迟20-100ms的环境下仍能保持正常功能

**性能要求示例**：
当有30个以上的用户同时对系统执行查询操作时，系统的响应时间应当不多于2秒，界面刷新频率应当在0.2次/秒~0.3次/秒。

### 4.2 安全和保密要求

#### 4.2.1 用户身份认证
- **用户身份验证**：系统必须对所有用户进行身份验证，防止未授权访问
- **登录安全机制**：
  - 防止同一账户多地同时登录
  - 密码验证失败3次后临时锁定账户10分钟
  - 用户会话超时自动断开（空闲30分钟）
- **用户ID唯一性**：确保用户ID在系统中的唯一性，防止身份冒充

#### 4.2.2 数据传输安全
- **消息传输保护**：所有用户消息在客户端和服务器之间的传输应考虑加密保护
- **文件传输安全**：图片文件在传输过程中应进行完整性校验
- **连接安全**：防止恶意连接和DDoS攻击，限制单IP连接数量

#### 4.2.3 数据存储安全
- **密码存储**：用户密码应进行加密存储（当前版本为明文存储，需要改进）
- **聊天记录保护**：用户聊天记录应只对相关用户可见，防止数据泄露
- **文件访问控制**：接收的图片文件应按用户隔离存储，防止交叉访问

#### 4.2.4 系统完整性保护
- **数据完整性**：确保用户数据、好友关系、群组信息的一致性和完整性
- **防恶意操作**：
  - 限制用户发送消息的频率（防止刷屏）
  - 验证所有用户操作的合法性
  - 防止SQL注入和恶意脚本攻击

#### 4.2.5 隐私保护要求
- **用户隐私**：保护用户个人信息不被未授权访问
- **聊天内容保密**：确保私聊内容只有通信双方可见
- **群聊权限控制**：只有群组成员才能查看群聊内容
- **在线状态隐私**：用户可以控制是否向他人显示在线状态

### 4.3 质量要求

#### 4.3.1 可靠性（Reliability）
- **故障率要求**：系统连续运行24小时的故障率应低于5%
- **数据丢失率**：消息丢失率应低于0.1%，聊天记录保存可靠性应达到99.9%
- **恢复能力**：系统故障后应能在10分钟内自动恢复或手动重启恢复
- **异常处理**：所有异常情况应有相应的处理机制，不会导致系统崩溃

#### 4.3.2 可维护性（Maintainability）
- **代码可读性**：代码应遵循良好的命名规范和注释规范
- **模块化设计**：系统采用模块化设计，便于功能扩展和维护
- **故障定位时间**：开发人员应能在30分钟内定位到系统故障原因
- **修复时间**：一般性Bug修复时间应不超过2个工作日

#### 4.3.3 有效性（Availability）
- **系统可用时间**：系统正常运行时间应占总时间的95%以上
- **服务可用性**：在系统负载正常的情况下，各项功能应保持100%可用
- **计划维护时间**：计划内维护时间应不超过每月2小时

#### 4.3.4 可用性（Usability）
- **学习难度**：新用户应能在30分钟内掌握基本操作
- **操作简便性**：常用功能（发送消息、添加好友）应在3步以内完成
- **界面友好性**：界面布局应清晰直观，符合用户习惯
- **错误提示**：操作错误时应给出明确的错误提示和解决建议

#### 4.3.5 重用性（Reusability）
- **组件重用**：核心组件（消息处理、网络通信）应具备重用性
- **协议扩展性**：消息协议应支持新消息类型的扩展
- **接口标准化**：系统各模块间的接口应标准化，便于集成

#### 4.3.6 可测试性（Testability）
- **单元测试覆盖率**：核心功能的单元测试覆盖率应达到80%以上
- **缺陷发现效率**：通过自动化测试应能发现80%以上的功能缺陷
- **测试环境**：应提供独立的测试环境和测试数据

#### 4.3.7 可移植性（Portability）
- **跨平台支持**：系统应能在Windows、macOS、Linux三大平台上运行
- **Java版本兼容**：应支持JDK 17及以上版本
- **环境依赖**：最小化外部环境依赖，便于部署

#### 4.3.8 质量属性优先级
当质量属性之间发生冲突时，优先级顺序如下：
1. **可靠性** - 优先保证系统稳定运行和数据安全
2. **安全性** - 确保用户数据和通信安全
3. **可用性** - 保证用户能够正常使用系统功能
4. **性能** - 在保证功能的前提下优化性能表现
5. **可维护性** - 便于后续功能扩展和问题修复

## 5. 系统出错处理设计

### 5.1 出错信息

#### 5.1.1 网络连接错误
- **服务器连接失败**：
  - 错误代码：NET_001
  - 错误信息："无法连接到服务器，请检查网络连接或服务器状态"
  - 可能原因：服务器未启动、网络故障、防火墙阻挡

- **连接超时**：
  - 错误代码：NET_002
  - 错误信息："连接超时，请稍后重试"
  - 可能原因：网络延迟过高、服务器响应慢

- **连接中断**：
  - 错误代码：NET_003
  - 错误信息："与服务器的连接已断开，正在尝试重连..."
  - 可能原因：网络不稳定、服务器重启、客户端网络中断

#### 5.1.2 用户认证错误
- **登录失败**：
  - 错误代码：AUTH_001
  - 错误信息："用户ID或密码错误，请重新输入"
  - 可能原因：密码输入错误、用户ID不存在

- **重复登录**：
  - 错误代码：AUTH_002
  - 错误信息："该账户已在其他地方登录，请先退出后再试"
  - 可能原因：同一账户在多个客户端登录

- **用户注册失败**：
  - 错误代码：AUTH_003
  - 错误信息："用户ID已存在，请使用其他ID"
  - 可能原因：用户ID重复、格式不正确

- **会话过期**：
  - 错误代码：AUTH_004
  - 错误信息："登录会话已过期，请重新登录"
  - 可能原因：长时间无操作、系统重启

#### 5.1.3 消息传输错误
- **消息发送失败**：
  - 错误代码：MSG_001
  - 错误信息："消息发送失败，对方可能已离线"
  - 可能原因：接收方离线、网络故障、消息格式错误

- **图片发送失败**：
  - 错误代码：MSG_002
  - 错误信息："图片发送失败，文件可能过大或格式不支持"
  - 可能原因：文件超过大小限制、文件格式不支持、编码失败

- **消息接收异常**：
  - 错误代码：MSG_003
  - 错误信息："消息接收异常，部分消息可能丢失"
  - 可能原因：网络中断、数据损坏

#### 5.1.4 好友系统错误
- **好友请求发送失败**：
  - 错误代码：FRIEND_001
  - 错误信息："好友请求发送失败，用户可能不存在"
  - 可能原因：目标用户ID不存在、已经是好友、重复请求

- **好友操作权限错误**：
  - 错误代码：FRIEND_002
  - 错误信息："操作失败，您没有权限执行此操作"
  - 可能原因：操作对象不是好友、权限不足

#### 5.1.5 群组系统错误
- **群组创建失败**：
  - 错误代码：GROUP_001
  - 错误信息："群组创建失败，群组ID已存在"
  - 可能原因：群组ID重复、格式不正确

- **群组邀请失败**：
  - 错误代码：GROUP_002
  - 错误信息："群组邀请发送失败，用户可能不存在或已在群组中"
  - 可能原因：目标用户不存在、已经是群成员

- **群组权限错误**：
  - 错误代码：GROUP_003
  - 错误信息："您不是该群组成员，无法执行此操作"
  - 可能原因：用户不在群组中、权限不足

#### 5.1.6 文件系统错误
- **文件读写错误**：
  - 错误代码：FILE_001
  - 错误信息："数据保存失败，请检查磁盘空间和权限"
  - 可能原因：磁盘空间不足、文件权限不够、文件被占用

- **数据文件损坏**：
  - 错误代码：FILE_002
  - 错误信息："数据文件损坏，部分功能可能异常"
  - 可能原因：文件格式错误、数据损坏、编码问题

#### 5.1.7 系统资源错误
- **内存不足**：
  - 错误代码：SYS_001
  - 错误信息："系统内存不足，请关闭其他程序后重试"
  - 可能原因：内存使用过多、内存泄漏

- **线程创建失败**：
  - 错误代码：SYS_002
  - 错误信息："系统繁忙，请稍后重试"
  - 可能原因：线程数量达到上限、系统资源不足

### 5.2 出错处理

#### 5.2.1 网络连接错误处理
- **服务器连接失败处理**：
  - 立即显示错误提示信息
  - 每隔5秒自动尝试重连，最多尝试10次
  - 提供手动重连按钮
  - 记录连接失败日志
  - 引导用户检查网络设置

- **连接超时处理**：
  - 显示超时提示
  - 自动尝试重新连接，延时递增（5秒、10秒、20秒）
  - 超过3次失败后停止自动重连
  - 提供网络诊断建议

- **连接中断处理**：
  - 立即检测连接状态
  - 缓存未发送的消息
  - 自动重连成功后发送缓存消息
  - 显示重连状态提示
  - 记录断线和重连时间

#### 5.2.2 用户认证错误处理
- **登录失败处理**：
  - 清空密码输入框
  - 显示具体的错误原因
  - 提供找回密码功能（如果支持）
  - 记录登录失败次数
  - 防止暴力破解攻击

- **重复登录处理**：
  - 询问用户是否强制登录
  - 如果选择强制登录，断开其他连接
  - 记录重复登录事件
  - 向其他登录地发送下线通知

- **会话过期处理**：
  - 自动跳转到登录界面
  - 保存当前用户操作状态
  - 重新登录后恢复之前的操作
  - 提示用户会话过期原因

#### 5.2.3 消息传输错误处理
- **消息发送失败处理**：
  - 在消息旁显示发送失败标识
  - 提供重新发送按钮
  - 将失败消息保存到本地队列
  - 网络恢复后自动重发
  - 记录发送失败的消息内容和时间

- **图片发送失败处理**：
  - 检查文件大小和格式
  - 提供文件压缩建议
  - 显示具体的失败原因
  - 支持重新选择文件发送
  - 记录文件发送失败日志

- **消息接收异常处理**：
  - 请求服务器重新发送丢失消息
  - 检查本地数据完整性
  - 修复损坏的聊天记录文件
  - 向用户报告数据丢失情况

#### 5.2.4 好友系统错误处理
- **好友请求发送失败处理**：
  - 验证目标用户ID的有效性
  - 检查是否已存在好友关系
  - 提供用户ID查找建议
  - 记录请求失败原因
  - 提供重新发送选项

- **好友操作权限错误处理**：
  - 刷新好友列表状态
  - 检查用户权限
  - 提示用户正确的操作方式
  - 记录权限错误事件

#### 5.2.5 群组系统错误处理
- **群组创建失败处理**：
  - 检查群组ID的唯一性
  - 提供群组ID生成建议
  - 验证群组信息格式
  - 提供重新创建选项
  - 记录创建失败原因

- **群组邀请失败处理**：
  - 验证被邀请用户的存在性
  - 检查用户是否已在群组中
  - 提供用户查找功能
  - 记录邀请失败信息

#### 5.2.6 文件系统错误处理
- **文件读写错误处理**：
  - 检查磁盘空间
  - 验证文件权限
  - 创建备份文件
  - 尝试在临时目录写入
  - 提示用户释放磁盘空间
  - 记录文件操作错误日志

- **数据文件损坏处理**：
  - 尝试自动修复文件格式
  - 从备份文件恢复数据
  - 重建损坏的数据文件
  - 向用户报告数据丢失情况
  - 提供数据导出功能

#### 5.2.7 系统资源错误处理
- **内存不足处理**：
  - 释放不必要的缓存数据
  - 关闭非必要的功能模块
  - 垃圾回收强制执行
  - 提示用户重启程序
  - 记录内存使用情况

- **线程创建失败处理**：
  - 复用现有线程资源
  - 延迟非关键任务的执行
  - 限制并发操作数量
  - 提供系统繁忙提示
  - 记录线程使用情况

#### 5.2.8 通用错误处理原则
1. **用户友好性**：错误信息应通俗易懂，避免技术术语
2. **问题诊断**：提供详细的错误原因和解决建议
3. **自动恢复**：尽可能自动处理错误，减少用户干预
4. **数据保护**：确保错误情况下用户数据不丢失
5. **日志记录**：详细记录错误信息，便于问题排查
6. **优雅降级**：部分功能出错时，不影响其他功能正常使用
7. **错误上报**：将关键错误信息上报给开发团队

---

*文档版本：v1.0*  
*最后更新：2024年1月*